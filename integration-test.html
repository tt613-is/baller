<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´æ¶æ„é›†æˆæµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            overflow-x: hidden;
        }
        
        canvas {
            border: 2px solid #4CAF50;
            background: #000;
            display: block;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }
        
        .info {
            text-align: center;
            margin: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .controls {
            text-align: center;
            margin: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 14px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .status-card h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        
        .status-card .value {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
        }
        
        .log {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #333;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-info { color: #4CAF50; }
        .log-warn { color: #FF9800; }
        .log-error { color: #F44336; }
        .log-debug { color: #2196F3; }
        
        .architecture-info {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .file-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
        }
        
        .file-name {
            font-weight: bold;
            color: #4CAF50;
        }
        
        .file-desc {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>ğŸ€ ç¯®çƒæ¸¸æˆ - å®Œæ•´æ¶æ„é›†æˆæµ‹è¯•</h1>
        <p>æ–°çš„8æ–‡ä»¶æ¨¡å—åŒ–æ¶æ„ - çŠ¶æ€æœºé©±åŠ¨çš„æ¸¸æˆå¼•æ“</p>
    </div>
    
    <div class="architecture-info">
        <h2>ğŸ“ æ–°æ¶æ„æ–‡ä»¶ç»“æ„</h2>
        <div class="file-list">
            <div class="file-item">
                <div class="file-name">js/core/GameEngine.js</div>
                <div class="file-desc">æ ¸å¿ƒå¼•æ“ - äº‹ä»¶æ€»çº¿ã€çŠ¶æ€æœºã€ä¸»å¾ªç¯</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/data/GameData.js</div>
                <div class="file-desc">æ¸¸æˆæ•°æ® - é…ç½®ã€é¢„è®¾ã€å¸¸é‡</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/utils/GameUtils.js</div>
                <div class="file-desc">å·¥å…·å‡½æ•° - æ•°å­¦ã€Canvasã€ç¢°æ’æ£€æµ‹</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/core/GameStates.js</div>
                <div class="file-desc">æ¸¸æˆçŠ¶æ€ - èœå•ã€æ¸¸æˆã€æš‚åœã€è®¾ç½®</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/components/GameObjects.js</div>
                <div class="file-desc">æ¸¸æˆå¯¹è±¡ - ç©å®¶ã€æ•Œäººã€ç¯®çƒã€ç²’å­</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/systems/GameSystems.js</div>
                <div class="file-desc">æ¸¸æˆç³»ç»Ÿ - æ¸²æŸ“ã€ç‰©ç†ã€ç¢°æ’ã€åŠ¨ç”»</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/managers/GameManagers.js</div>
                <div class="file-desc">ç®¡ç†å™¨ - è¾“å…¥ã€èµ„æºã€é…ç½®ã€å­˜å‚¨</div>
            </div>
            <div class="file-item">
                <div class="file-name">js/ui/UIComponents.js</div>
                <div class="file-desc">UIç»„ä»¶ - æŒ‰é’®ã€èœå•ã€å¯¹è¯æ¡†ã€é¢æ¿</div>
            </div>
        </div>
    </div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div class="controls">
        <button onclick="startGame()">ğŸš€ å¯åŠ¨æ¸¸æˆ</button>
        <button onclick="testStates()">ğŸ”„ æµ‹è¯•çŠ¶æ€åˆ‡æ¢</button>
        <button onclick="testSystems()">âš™ï¸ æµ‹è¯•ç³»ç»Ÿ</button>
        <button onclick="testManagers()">ğŸ“Š æµ‹è¯•ç®¡ç†å™¨</button>
        <button onclick="testUI()">ğŸ¨ æµ‹è¯•UIç»„ä»¶</button>
        <button onclick="runStressTest()">ğŸ’ª å‹åŠ›æµ‹è¯•</button>
        <button onclick="exportConfig()">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
        <button onclick="resetGame()">ğŸ”„ é‡ç½®æ¸¸æˆ</button>
    </div>
    
    <div class="status-grid">
        <div class="status-card">
            <h3>ğŸ® å½“å‰çŠ¶æ€</h3>
            <div class="value" id="currentState">æœªåˆå§‹åŒ–</div>
        </div>
        <div class="status-card">
            <h3>âš¡ FPS</h3>
            <div class="value" id="fps">0</div>
        </div>
        <div class="status-card">
            <h3>ğŸ“¦ å·²åŠ è½½ç»„ä»¶</h3>
            <div class="value" id="loadedComponents">0/8</div>
        </div>
        <div class="status-card">
            <h3>ğŸ¯ äº‹ä»¶è®¡æ•°</h3>
            <div class="value" id="eventCount">0</div>
        </div>
        <div class="status-card">
            <h3>ğŸ’¾ å†…å­˜ä½¿ç”¨</h3>
            <div class="value" id="memoryUsage">-- MB</div>
        </div>
        <div class="status-card">
            <h3>ğŸŒŸ æµ‹è¯•é€šè¿‡</h3>
            <div class="value" id="testsPass">0/6</div>
        </div>
    </div>
    
    <div id="log" class="log">
        <div class="log-entry log-info">ğŸ”§ ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼Œç­‰å¾…å¯åŠ¨...</div>
    </div>

    <script type="module">
        // å¯¼å…¥æ‰€æœ‰æ¨¡å—
        import { GameEngine } from './js/core/GameEngine.js';
        import { GameConfig } from './js/data/GameData.js';
        import { MenuState, PlayingState, PausedState, CustomizationState, GameOverState, WinState } from './js/core/GameStates.js';
        import { Player, Defender, Basketball, Particle, Spectator } from './js/components/GameObjects.js';
        import { RenderSystem, PhysicsSystem, CollisionSystem, AnimationSystem, ParticleSystem, StarFieldSystem, ShootingSystem } from './js/systems/GameSystems.js';
        import { InputManager, AssetManager, ConfigManager, StorageManager, EffectsManager } from './js/managers/GameManagers.js';
        import { UIManager, Button, Label, ProgressBar, Panel, Menu, Dialog } from './js/ui/UIComponents.js';
        import { MathUtils, CanvasUtils, ColorUtils, PerformanceUtils } from './js/utils/GameUtils.js';

        // å…¨å±€å˜é‡
        let gameEngine = null;
        let testResults = {
            engine: false,
            states: false,
            systems: false,
            managers: false,
            ui: false,
            stress: false
        };
        let eventCounter = 0;
        let loadedComponents = 0;

        // æ—¥å¿—ç³»ç»Ÿ
        const log = {
            info: (msg) => addLogEntry(msg, 'info'),
            warn: (msg) => addLogEntry(msg, 'warn'),
            error: (msg) => addLogEntry(msg, 'error'),
            debug: (msg) => addLogEntry(msg, 'debug')
        };

        function addLogEntry(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            if (logDiv.children.length > 100) {
                logDiv.removeChild(logDiv.firstChild);
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            if (gameEngine) {
                document.getElementById('currentState').textContent = gameEngine.stateMachine.getCurrentStateName();
                document.getElementById('fps').textContent = gameEngine.getFPS();
            }
            document.getElementById('eventCount').textContent = eventCounter;
            document.getElementById('loadedComponents').textContent = `${loadedComponents}/8`;
            
            const passedTests = Object.values(testResults).filter(Boolean).length;
            document.getElementById('testsPass').textContent = `${passedTests}/6`;

            // å†…å­˜ä½¿ç”¨ï¼ˆå¦‚æœæ”¯æŒï¼‰
            if (performance.memory) {
                const used = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memoryUsage').textContent = `${used} MB`;
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        window.startGame = async function() {
            try {
                log.info('ğŸš€ å¼€å§‹å¯åŠ¨æ¸¸æˆå¼•æ“...');
                
                if (gameEngine) {
                    gameEngine.destroy();
                }

                // åˆ›å»ºæ¸¸æˆå¼•æ“
                gameEngine = new GameEngine('gameCanvas');
                loadedComponents++;
                log.info('âœ… GameEngine åˆ›å»ºæˆåŠŸ');

                // æ³¨å†Œæ‰€æœ‰æ¸¸æˆçŠ¶æ€
                gameEngine.registerState('menu', new MenuState(gameEngine));
                gameEngine.registerState('playing', new PlayingState(gameEngine));
                gameEngine.registerState('paused', new PausedState(gameEngine));
                gameEngine.registerState('customization', new CustomizationState(gameEngine));
                gameEngine.registerState('gameOver', new GameOverState(gameEngine));
                gameEngine.registerState('win', new WinState(gameEngine));
                loadedComponents++;
                log.info('âœ… GameStates æ³¨å†Œå®Œæˆ');

                // äº‹ä»¶ç›‘å¬
                gameEngine.eventBus.on('stateChanged', (data) => {
                    eventCounter++;
                    log.info(`ğŸ”„ çŠ¶æ€åˆ‡æ¢: ${data.state}`);
                });

                gameEngine.eventBus.on('input', (data) => {
                    eventCounter++;
                });

                // å¯åŠ¨å¼•æ“
                gameEngine.start('menu');
                loadedComponents = 8; // æ‰€æœ‰ç»„ä»¶å·²åŠ è½½
                testResults.engine = true;
                
                log.info('ğŸ‰ æ¸¸æˆå¼•æ“å¯åŠ¨æˆåŠŸï¼');
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                setInterval(updateStatus, 100);

            } catch (error) {
                log.error(`âŒ å¯åŠ¨å¤±è´¥: ${error.message}`);
                console.error('Startup error:', error);
            }
        };

        // æµ‹è¯•çŠ¶æ€åˆ‡æ¢
        window.testStates = function() {
            if (!gameEngine) {
                log.warn('âš ï¸ è¯·å…ˆå¯åŠ¨æ¸¸æˆå¼•æ“');
                return;
            }

            log.info('ğŸ”„ å¼€å§‹æµ‹è¯•çŠ¶æ€åˆ‡æ¢...');
            const states = ['menu', 'playing', 'customization', 'paused', 'gameOver', 'win'];
            let currentIndex = 0;

            const testInterval = setInterval(() => {
                const nextState = states[currentIndex % states.length];
                gameEngine.stateMachine.changeState(nextState, null, true);
                log.debug(`æµ‹è¯•çŠ¶æ€: ${nextState}`);
                currentIndex++;

                if (currentIndex >= states.length * 2) {
                    clearInterval(testInterval);
                    gameEngine.stateMachine.changeState('menu', null, true);
                    testResults.states = true;
                    log.info('âœ… çŠ¶æ€åˆ‡æ¢æµ‹è¯•å®Œæˆ');
                }
            }, 1000);
        };

        // æµ‹è¯•ç³»ç»Ÿ
        window.testSystems = function() {
            if (!gameEngine) {
                log.warn('âš ï¸ è¯·å…ˆå¯åŠ¨æ¸¸æˆå¼•æ“');
                return;
            }

            log.info('âš™ï¸ å¼€å§‹æµ‹è¯•æ¸¸æˆç³»ç»Ÿ...');
            
            try {
                const canvas = document.getElementById('gameCanvas');
                const ctx = canvas.getContext('2d');

                // æµ‹è¯•æ¸²æŸ“ç³»ç»Ÿ
                const renderSystem = new RenderSystem(canvas, ctx, gameEngine.eventBus);
                renderSystem.drawBackground('day');
                log.debug('âœ“ æ¸²æŸ“ç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                // æµ‹è¯•ç‰©ç†ç³»ç»Ÿ
                const testObject = { x: 0, y: 0, velocity: { x: 5, y: 5 } };
                PhysicsSystem.updateMovement(testObject, 16.67);
                log.debug('âœ“ ç‰©ç†ç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                // æµ‹è¯•ç¢°æ’ç³»ç»Ÿ
                const collisionSystem = new CollisionSystem(gameEngine.eventBus);
                const collision = collisionSystem.checkCollision(
                    { x: 0, y: 0, width: 10, height: 10 },
                    { x: 5, y: 5, width: 10, height: 10 }
                );
                log.debug('âœ“ ç¢°æ’ç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                // æµ‹è¯•åŠ¨ç”»ç³»ç»Ÿ
                const animationSystem = new AnimationSystem();
                const tween = animationSystem.createTween({ x: 0 }, { x: 100 }, 1000);
                log.debug('âœ“ åŠ¨ç”»ç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                // æµ‹è¯•ç²’å­ç³»ç»Ÿ
                const particleSystem = new ParticleSystem(gameEngine.eventBus);
                particleSystem.createScoreEffect(400, 300, 100);
                log.debug('âœ“ ç²’å­ç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                // æµ‹è¯•æ˜Ÿç©ºç³»ç»Ÿ
                const starFieldSystem = new StarFieldSystem();
                starFieldSystem.update(16.67);
                log.debug('âœ“ æ˜Ÿç©ºç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                // æµ‹è¯•æŠ•ç¯®ç³»ç»Ÿ
                const shootingSystem = new ShootingSystem(gameEngine.eventBus);
                shootingSystem.startAiming();
                log.debug('âœ“ æŠ•ç¯®ç³»ç»Ÿæµ‹è¯•é€šè¿‡');

                testResults.systems = true;
                log.info('âœ… æ¸¸æˆç³»ç»Ÿæµ‹è¯•å®Œæˆ');

            } catch (error) {
                log.error(`âŒ ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };

        // æµ‹è¯•ç®¡ç†å™¨
        window.testManagers = function() {
            if (!gameEngine) {
                log.warn('âš ï¸ è¯·å…ˆå¯åŠ¨æ¸¸æˆå¼•æ“');
                return;
            }

            log.info('ğŸ“Š å¼€å§‹æµ‹è¯•ç®¡ç†å™¨...');
            
            try {
                const canvas = document.getElementById('gameCanvas');

                // æµ‹è¯•è¾“å…¥ç®¡ç†å™¨
                const inputManager = new InputManager(canvas, gameEngine.eventBus);
                log.debug('âœ“ è¾“å…¥ç®¡ç†å™¨æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•èµ„æºç®¡ç†å™¨
                const assetManager = new AssetManager(gameEngine.eventBus);
                log.debug('âœ“ èµ„æºç®¡ç†å™¨æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•é…ç½®ç®¡ç†å™¨
                const configManager = new ConfigManager(gameEngine.eventBus);
                configManager.set('test.value', 42);
                const value = configManager.get('test.value');
                if (value === 42) {
                    log.debug('âœ“ é…ç½®ç®¡ç†å™¨æµ‹è¯•é€šè¿‡');
                }

                // æµ‹è¯•å­˜å‚¨ç®¡ç†å™¨
                const storageManager = new StorageManager(gameEngine.eventBus);
                storageManager.saveGameData(0, { score: 1000, level: 5 });
                const gameData = storageManager.loadGameData(0);
                if (gameData && gameData.score === 1000) {
                    log.debug('âœ“ å­˜å‚¨ç®¡ç†å™¨æµ‹è¯•é€šè¿‡');
                }

                // æµ‹è¯•ç‰¹æ•ˆç®¡ç†å™¨
                const effectsManager = new EffectsManager(gameEngine.eventBus);
                effectsManager.addScreenShake(10, 500);
                effectsManager.addFadeTransition('fadeOut', 1000);
                log.debug('âœ“ ç‰¹æ•ˆç®¡ç†å™¨æµ‹è¯•é€šè¿‡');

                testResults.managers = true;
                log.info('âœ… ç®¡ç†å™¨æµ‹è¯•å®Œæˆ');

            } catch (error) {
                log.error(`âŒ ç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };

        // æµ‹è¯•UIç»„ä»¶
        window.testUI = function() {
            log.info('ğŸ¨ å¼€å§‹æµ‹è¯•UIç»„ä»¶...');
            
            try {
                const canvas = document.getElementById('gameCanvas');

                // æµ‹è¯•UIç®¡ç†å™¨
                const uiManager = new UIManager(canvas, gameEngine?.eventBus);
                log.debug('âœ“ UIç®¡ç†å™¨æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•æŒ‰é’®
                const button = new Button(50, 50, 120, 40, 'æµ‹è¯•æŒ‰é’®');
                button.on('click', () => log.debug('æŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘'));
                uiManager.addComponent(button);
                log.debug('âœ“ æŒ‰é’®ç»„ä»¶æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•æ ‡ç­¾
                const label = new Label(50, 100, 'æµ‹è¯•æ ‡ç­¾');
                uiManager.addComponent(label);
                log.debug('âœ“ æ ‡ç­¾ç»„ä»¶æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•è¿›åº¦æ¡
                const progressBar = new ProgressBar(50, 150, 200, 20);
                progressBar.setValue(0.7);
                uiManager.addComponent(progressBar);
                log.debug('âœ“ è¿›åº¦æ¡ç»„ä»¶æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•é¢æ¿
                const panel = new Panel(300, 50, 200, 150);
                panel.addChild(new Label(10, 10, 'é¢æ¿å†…å®¹'));
                uiManager.addComponent(panel);
                log.debug('âœ“ é¢æ¿ç»„ä»¶æµ‹è¯•é€šè¿‡');

                // æµ‹è¯•èœå•
                const menu = new Menu(550, 50, 150, 120);
                menu.addItem('é€‰é¡¹ 1');
                menu.addItem('é€‰é¡¹ 2');
                menu.addItem('é€‰é¡¹ 3');
                uiManager.addComponent(menu);
                log.debug('âœ“ èœå•ç»„ä»¶æµ‹è¯•é€šè¿‡');

                // æ¸²æŸ“æµ‹è¯•
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                uiManager.render(ctx);

                testResults.ui = true;
                log.info('âœ… UIç»„ä»¶æµ‹è¯•å®Œæˆ');

            } catch (error) {
                log.error(`âŒ UIç»„ä»¶æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };

        // å‹åŠ›æµ‹è¯•
        window.runStressTest = function() {
            if (!gameEngine) {
                log.warn('âš ï¸ è¯·å…ˆå¯åŠ¨æ¸¸æˆå¼•æ“');
                return;
            }

            log.info('ğŸ’ª å¼€å§‹å‹åŠ›æµ‹è¯•...');
            
            const startTime = performance.now();
            let frameCount = 0;
            const testDuration = 5000; // 5ç§’

            const stressInterval = setInterval(() => {
                // åˆ›å»ºå¤§é‡å¯¹è±¡è¿›è¡Œæµ‹è¯•
                for (let i = 0; i < 100; i++) {
                    const particle = new Particle(
                        Math.random() * 800,
                        Math.random() * 600,
                        {
                            vx: (Math.random() - 0.5) * 10,
                            vy: (Math.random() - 0.5) * 10,
                            life: 1000
                        }
                    );
                    eventCounter++;
                }

                frameCount++;
                const elapsed = performance.now() - startTime;
                
                if (elapsed >= testDuration) {
                    clearInterval(stressInterval);
                    const avgFPS = Math.round((frameCount / testDuration) * 1000);
                    testResults.stress = avgFPS > 30; // è‡³å°‘30FPSç®—é€šè¿‡
                    log.info(`âœ… å‹åŠ›æµ‹è¯•å®Œæˆ - å¹³å‡FPS: ${avgFPS}`);
                }
            }, 16); // çº¦60FPS
        };

        // å¯¼å‡ºé…ç½®
        window.exportConfig = function() {
            const config = {
                architecture: '8-file modular architecture',
                components: [
                    'GameEngine', 'GameData', 'GameUtils', 'GameStates',
                    'GameObjects', 'GameSystems', 'GameManagers', 'UIComponents'
                ],
                testResults,
                timestamp: new Date().toISOString(),
                performance: {
                    fps: gameEngine ? gameEngine.getFPS() : 0,
                    eventCount: eventCounter,
                    loadedComponents
                }
            };

            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'basketball-game-config.json';
            a.click();
            URL.revokeObjectURL(url);

            log.info('ğŸ“¤ é…ç½®å·²å¯¼å‡º');
        };

        // é‡ç½®æ¸¸æˆ
        window.resetGame = function() {
            if (gameEngine) {
                gameEngine.destroy();
                gameEngine = null;
            }
            
            eventCounter = 0;
            loadedComponents = 0;
            testResults = {
                engine: false,
                states: false,
                systems: false,
                managers: false,
                ui: false,
                stress: false
            };

            const logDiv = document.getElementById('log');
            logDiv.innerHTML = '';
            
            log.info('ğŸ”„ æ¸¸æˆå·²é‡ç½®');
            updateStatus();
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log.info('ğŸ® ç¯®çƒæ¸¸æˆé›†æˆæµ‹è¯•ç³»ç»Ÿå‡†å¤‡å°±ç»ª');
            log.info('ğŸ“¦ å·²åŠ è½½8ä¸ªæ ¸å¿ƒæ¨¡å—');
            log.info('ğŸš€ ç‚¹å‡»"å¯åŠ¨æ¸¸æˆ"å¼€å§‹æµ‹è¯•');
            updateStatus();
        });

        // å¯¼å‡ºåˆ°å…¨å±€ï¼Œä¾¿äºè°ƒè¯•
        window.gameEngine = () => gameEngine;
        window.log = log;
        window.testResults = testResults;
    </script>
</body>
</html>